각인 최적화는 기본적으로 아래와 같이 진행됩니다.

후보 각인 탐색 -> 경매장 검색 -> 검색 결과 조합

후보 각인 탐색은 숫자를 쪼개는것부터 시작합니다.

splitNumbers() 함수는 특정 숫자를 3~5 (유물의 경우 6) 숫자들의 합으로 나타낼 수 있는 모든 경우를 반환합니다.

예를 들어 아래와 같은 각인을 5개의 악세로 조합하고 싶다고 해보겠습니다.

33333에서 쌍전각, 87돌을 가정한 상황입니다.

원한 3
예둔 3
돌대 15
바리 8
아드 7

splitNumbers(3)
[[3]]

splitNumbers(3)
[[3]]

splitNumbers(15)
[
[3, 3, 3, 3, 3],
[3, 3, 4, 5],
[3, 4, 4, 4],
[5, 5, 5],
]

splitNumbers(8)
[
[3, 3, 3],
[3, 5],
[4, 4],
]

splitNumbers(7)
[
[3, 3, 3],
[3, 4],
]

7과 8의 경우에 3,3,3이 들어가는 이유는, 전부 3으로 이루어지는 경우에는 최대 2까지 합을 초과하는 것을 허용하기 때문입니다.

이 경우를 허용하는 이유는, 33331에서 직각을 5가 아닌 3+3으로 맞추는 경우 등 3을 여러개로 나누는게 더 효율적인 경우가 있기 때문입니다.

다음으로, 이렇게 나온 배열들에 대해 모든 조합을 뽑아냅니다.

[[원한], [예둔], [돌대], [바리], [아드]]
[[3], [3], [3, 3, 3, 3, 3], [3, 3, 3], [3, 3, 3]]
[[3], [3], [3, 3, 3, 3, 3], [3, 3, 3], [3, 4]]
[[3], [3], [3, 3, 3, 3, 3], [3, 5], [3, 3, 3]]
[[3], [3], [3, 3, 3, 3, 3], [3, 5], [3, 4]]
[[3], [3], [3, 3, 3, 3, 3], [4, 4], [3, 3, 3]]
[[3], [3], [3, 3, 3, 3, 3], [4, 4], [3, 4]]
[[3], [3], [3, 3, 4, 5], [3, 3, 3], [3, 3, 3]]
[[3], [3], [3, 3, 4, 5], [3, 3, 3], [3, 4]]
[[3], [3], [3, 3, 4, 5], [3, 5], [3, 3, 3]]
[[3], [3], [3, 3, 4, 5], [3, 5], [3, 4]]
[[3], [3], [3, 3, 4, 5], [4, 4], [3, 3, 3]]
[[3], [3], [3, 3, 4, 5], [4, 4], [3, 4]]
[[3], [3], [3, 4, 4, 4], [3, 3, 3], [3, 3, 3]]
[[3], [3], [3, 4, 4, 4], [3, 3, 3], [3, 4]]
[[3], [3], [3, 4, 4, 4], [3, 5], [3, 3, 3]]
[[3], [3], [3, 4, 4, 4], [3, 5], [3, 4]]
[[3], [3], [3, 4, 4, 4], [4, 4], [3, 3, 3]]
[[3], [3], [3, 4, 4, 4], [4, 4], [3, 4]]
[[3], [3], [5, 5, 5], [3, 3, 3], [3, 3, 3]]
[[3], [3], [5, 5, 5], [3, 3, 3], [3, 4]]
[[3], [3], [5, 5, 5], [3, 5], [3, 3, 3]]
[[3], [3], [5, 5, 5], [3, 5], [3, 4]]
[[3], [3], [5, 5, 5], [4, 4], [3, 3, 3]]
[[3], [3], [5, 5, 5], [4, 4], [3, 4]]

이 다음, 생성된 조합들을 두가지 규칙에 따라 필터합니다.

1. 숫자들의 개수는 (악세 부위수 \* 2) 이하여야 한다.
2. 숫자들 중 3이 초과하는 것의 개수는 (악세 부위수) 이하여야 한다.

1번 조건은 악세별로 각인이 2개까지 붙기 때문에, 5개의 악세로 11개의 숫자 조합을 만들 수 없기 때문이고,
2번 조건은 악세에 붙는 각인 2개 중 1개는 반드시 3이기 때문에, 5개의 악세로 4~6의 숫자를 6개 이상 집어넣을 수 없이 때문입니다.

해당 조건으로 필터를 진행한 결과

[[원한], [예둔], [돌대], [바리], [아드]]
[[3], [3], [3, 3, 3, 3, 3], [3, 3, 3], [3, 3, 3]] - 길이 13, 1번 조건 필터
[[3], [3], [3, 3, 3, 3, 3], [3, 3, 3], [3, 4]] - 길이 12, 필터
[[3], [3], [3, 3, 3, 3, 3], [3, 5], [3, 3, 3]] - 길이 12, 필터
[[3], [3], [3, 3, 3, 3, 3], [3, 5], [3, 4]] - 길이 11, 필터
[[3], [3], [3, 3, 3, 3, 3], [4, 4], [3, 3, 3]] - 길이 13, 필터
[[3], [3], [3, 3, 3, 3, 3], [4, 4], [3, 4]] - 길이 12, 필터
[[3], [3], [3, 3, 4, 5], [3, 3, 3], [3, 3, 3]] - 길이 12, 필터
[[3], [3], [3, 3, 4, 5], [3, 3, 3], [3, 4]] - 길이 11, 필터
[[3], [3], [3, 3, 4, 5], [3, 5], [3, 3, 3]] - 길이 11, 필터
[[3], [3], [3, 3, 4, 5], [3, 5], [3, 4]] - 통과
[[3], [3], [3, 3, 4, 5], [4, 4], [3, 3, 3]] - 길이 11, 필터
[[3], [3], [3, 3, 4, 5], [4, 4], [3, 4]] - 통과
[[3], [3], [3, 4, 4, 4], [3, 3, 3], [3, 3, 3]] - 길이 12, 필터
[[3], [3], [3, 4, 4, 4], [3, 3, 3], [3, 4]] - 길이 11, 필터
[[3], [3], [3, 4, 4, 4], [3, 5], [3, 3, 3]] - 길이 11, 필터
[[3], [3], [3, 4, 4, 4], [3, 5], [3, 4]] - 통과
[[3], [3], [3, 4, 4, 4], [4, 4], [3, 3, 3]] - 길이 11, 필터
[[3], [3], [3, 4, 4, 4], [4, 4], [3, 4]] - 4가 6개, 필터
[[3], [3], [5, 5, 5], [3, 3, 3], [3, 3, 3]] - 길이 11, 필터
[[3], [3], [5, 5, 5], [3, 3, 3], [3, 4]] - 통과
[[3], [3], [5, 5, 5], [3, 5], [3, 3, 3]] - 통과
[[3], [3], [5, 5, 5], [3, 5], [3, 4]] - 통과
[[3], [3], [5, 5, 5], [4, 4], [3, 3, 3]] - 통과
[[3], [3], [5, 5, 5], [4, 4], [3, 4]] - 4~5가 6개, 필터

따라서, 실제로 가능한 조합은 아래와 같이 남습니다.
[[원한], [예둔], [돌대], [바리], [아드]]
[[3], [3], [3, 3, 4, 5], [3, 5], [3, 4]]
[[3], [3], [3, 3, 4, 5], [4, 4], [3, 4]]
[[3], [3], [3, 4, 4, 4], [3, 5], [3, 4]]
[[3], [3], [5, 5, 5], [3, 3, 3], [3, 4]]
[[3], [3], [5, 5, 5], [3, 5], [3, 3, 3]]
[[3], [3], [5, 5, 5], [3, 5], [3, 4]]
[[3], [3], [5, 5, 5], [4, 4], [3, 3, 3]]

마지막으로, 길이가 (악세 부위수 \* 2)보다 짧은 조합에 대해 남은 길이만큼 잡옵을 3으로 채워줍니다.
[[원한], [예둔], [돌대], [바리], [아드], [잡옵]]
[[3], [3], [3, 3, 4, 5], [3, 5], [3, 4], []]
[[3], [3], [3, 3, 4, 5], [4, 4], [3, 4], []]
[[3], [3], [3, 4, 4, 4], [3, 5], [3, 4], []]
[[3], [3], [5, 5, 5], [3, 3, 3], [3, 4], []]
[[3], [3], [5, 5, 5], [3, 5], [3, 3, 3], []]
[[3], [3], [5, 5, 5], [3, 5], [3, 4], [3]]
[[3], [3], [5, 5, 5], [4, 4], [3, 3, 3], []]
